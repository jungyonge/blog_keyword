<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Setalarm">

    <select id="getKeywordMaster" resultType="HashMap" >
        SELECT
              keyword
        FROM keyword_master
        WHERE used = '사용안함';
    </select>

    <select id="getKeywordRelate" resultType="HashMap" >
        SELECT
              keyword_rel
        FROM keyword_relate
        WHERE used = '사용안함';
    </select>

    <select id="getMakeKeywordRelate" resultType="HashMap" >
        SELECT
              keyword_rel
        FROM keyword_relate
        WHERE used = '사용안함' AND make ='make';
    </select>


    <select id="getKeywordMasterForMake" resultType="HashMap" parameterType="map">
        SELECT
              st1
        FROM ${table}
        WHERE st1 !='';
    </select>

    <select id="getKeywordRelateForMake" resultType="HashMap" parameterType="map">
        SELECT
               st2
        FROM ${table}
        WHERE st2 !='';
    </select>

    <insert id="insertKeyword_Master" useGeneratedKeys="true" keyProperty="id" parameterType="map">
        INSERT INTO
        keyword_master (keyword)
        VALUES (#{keyword});
    </insert>

    <insert id="insertKeyword_Relate" useGeneratedKeys="true" keyProperty="id" parameterType="map">
        INSERT INTO
        keyword_relate (keyword_rel)
        VALUES (#{keyword});
    </insert>

    <insert id="insertMakeKeyword_Relate" useGeneratedKeys="true" keyProperty="id" parameterType="map">
        INSERT INTO
        keyword_relate (keyword_rel, make)
        VALUES (#{keyword} ,#{make});
    </insert>

    <insert id="insertKeywordStat" useGeneratedKeys="true" keyProperty="id" parameterType="map">
        INSERT INTO
            keyword_stat(relKeyword, monthlyPcQcCnt, monthlyMobileQcCnt, monthlyAvePcClkCnt,
                        monthlyAveMobileClkCnt, monthlyAvePcCtr, monthlyAveMobileCtr, plAvgDepth,
                        compIdx, totalPost, naverCnt, tistoryCnt, elseCnt, whereBlog, whereWeb, whereMobileBlog, whereMobileWeb ,make)
        VALUE
              (#{relKeyword}, #{monthlyPcQcCnt}, #{monthlyMobileQcCnt}, #{monthlyAvePcClkCnt},
              #{monthlyAveMobileClkCnt}, #{monthlyAvePcCtr}, #{monthlyAveMobileCtr}, #{plAvgDepth},
              #{compIdx}, #{totalPost}, #{naverCnt}, #{tistoryCnt}, #{elseCnt}, #{whereBlog}, #{whereWeb}, #{whereMobileBlog}, #{whereMobileWeb} ,#{make})
    </insert>

    <delete id="deleteKeyword_Master">
        DELETE FROM keyword_master WHERE
           id NOT IN (SELECT * FROM (SELECT MIN(id) FROM keyword_master GROUP BY keyword) AS temp);
    </delete>

    <delete id="deleteKeyword_Relete">
        DELETE FROM keyword_relate WHERE
           id NOT IN (SELECT * FROM (SELECT MIN(id) FROM keyword_relate GROUP BY keyword_rel) AS temp);
    </delete>

    <update id="updateUsed_Master">
      UPDATE keyword_master
        SET used = '사용함'
          WHERE keyword = #{keyword};
    </update>

    <update id="updateUsed_Relate" parameterType="map">
      UPDATE keyword_relate
        SET used = '사용함'
          WHERE keyword_rel = #{keyword_rel};
    </update>


</mapper>